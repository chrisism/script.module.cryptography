# Azure Devops Pipeline template
# 
# This pipeline template part defines the deployment or publishing
# of the addon in a kodi repository build in github.
#
# Needed vars
# - packageType (all|android)
parameters:
- name: 'packageType'
  type: string
  default: 'all'

steps:
  - task: CopyFiles@2
    displayName: 'Copy addon into git repository'
    inputs:
      SourceFolder: '$(Pipeline.Workspace)/$(addonName).${{parameters.packageType}}'
      Contents: '**/*.*'
      TargetFolder: '$(Pipeline.Workspace)/$(repository_name)/$(repository_data_dir)/$(addonName).${{parameters.packageType}}'
      CleanTargetFolder: false
      flattenFolders: false
      OverWrite: true
  
  - bash: merge_addon_xml $(addonName).${{parameters.packageType}} $(Pipeline.Workspace)/$(repository_name)/$(repository_data_dir)/addons.xml $(Pipeline.Workspace)/$(repository_name)/$(repository_data_dir)/$(addonName).${{parameters.packageType}}/addon.xml
    displayName: 'Merge addon xml files for repository'
    workingDirectory: '$(Pipeline.Workspace)/$(repository_name)/$(repository_data_dir)/'
      
  - script: md5sum addons.xml > addons.xml.md5
    workingDirectory: $(Pipeline.Workspace)/$(repository_name)/$(repository_data_dir)/
    displayName: 'Creating md5 file for addons.xml'
